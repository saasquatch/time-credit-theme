{{!--

  Core JavaScript to power widget functionality.

  TODO: Eventually this should get merged in as part of the {{squatchHead}} core helper instead of being manually included in every template

  Eventually we can abstract this.

--}}

<script>
  window.squatch = window.squatch || {};

  window.squatch.user = {
    code     : '{{referredBy.referredByUser.referralCode}}',
    sharelink: '{{shareLinks.shareLink}}',
    email    : {
      share : {
        subject: '{{urlencode (variables 'widget.REFERRER_WIDGET.content.shareMessaging.emailShareSubject') space="%20"}}',
        body: '{{urlencode (variables 'widget.REFERRER_WIDGET.content.shareMessaging.emailShareBody') space="%20"}}',
        mailToLink: 'mailto:?subject={{urlencode (variables 'widget.REFERRER_WIDGET.content.shareMessaging.emailShareSubject') space="%20"}}&body={{urlencode (variables 'shareMessaging.emailShareBody') space="%20"}}',
      },
      reminder: {
        subject: '{{urlencode (stringFormat "Get %s month(s) of free %s?" programDetails.referredRewardDetails.credit companyName) space="%20"}}',
        body: '{{urlencode (stringFormat "Sign up for a %s account and we both get %s month(s) for free. Use this link %s" companyName programDetails.referredRewardDetails.credit shareLinks.emailShareLink) space="%20"}}',
        mailToLink: 'mailto:?subject={{urlencode "How do you like Acme so far?" space="%20"}}&body={{urlencode (stringFormat "Hey,%n %nI saw that you signed up for Acme. What do you think of it so far?%n %nBy the way, if you\'ve lost the link to Acme, here it is again - %s" shareLinks.emailShareLink) space="%20"}}'
      },
      type: 'UNKNOWN'
    },
    facebook: {
      title: '{{urlencode (variables 'widget.REFERRER_WIDGET.content.shareMessaging.facebookShareSubject')}}',
      summary: '{{urlencode (variables 'widget.REFERRER_WIDGET.content.shareMessaging.facebookShareBody')}}',
      link: '{{shareLinks.facebookShareLink}}',
{{#if variables.widget.REFERRER_WIDGET.content.shareMessaging.facebookShareImageURL}}
      shareImage: '{{urlencode (variables 'variables.widget.REFERRER_WIDGET.content.shareMessaging.facebookShareImageURL')}}',
{{else}}
      shareImage: null,
{{/if}}
      appId: '157382547792399',
      redirectUrl: 'http://app.referralsaasquatch.com/widget/close'
    },
    twitter: {
      message: '{{urlencode (variables 'widget.REFERRER_WIDGET.content.shareMessaging.twitterShareBody')}}'
    },
    mobile: {
      sharelink : '{{shareLinks.shareLink}}',
      emailBody: '{{urlencode (stringFormat "Sign up for a %s account and we both get %s month(s) for free. Use this link %s" companyName programDetails.referredRewardDetails.credit shareLinks.mobileEmailShareLink)}}',
      facebookBody: '{{urlencode (stringFormat "Sign up for a %s account and we both get %s month(s) for free. Use this link %s" companyName programDetails.referredRewardDetails.credit shareLinks.mobileFacebookShareLink)}}',
      twitterBody: '{{urlencode (variables 'widget.REFERRER_WIDGET.content.shareMessaging.twitterShareBody') space="%20"}}',
      twitterShareLink : '{{shareLinks.mobileTwitterShareLink}}',
      facebookShareLink : '{{shareLinks.mobileFacebookShareLink}}',
      emailShareLink: '{{shareLinks.mobileEmailShareLink}}'
    },
    fallbackImg: 'https://www.gravatar.com/avatar/0?d=blank'
  };

  window.squatch.analytics = {
    apikey    : '{{segmentApiKey}}',
    attributes: {
      tenant   : '{{tenantAlias}}',
      userId   : '{{user.id}}',
      accountId: '{{user.accountId}}'
    },
    user: {
      ident : '{{user.id}}',
      traits: {
        tenant   : '{{tenantAlias}}',
        accountId: '{{user.accountId}}'
      }
    },
    events: {
      OPENED_WIDGET : 'Opened Widget',
      OPENED_POPUP  : 'Opened Popup',
      CLOSED_POPUP  : 'Closed Popup',
      FACEBOOK_SHARE: 'Clicked Facebook Share',
      TWITTER_SHARE : 'Clicked Twitter Share',
      EMAIL_SHARE   : 'Clicked Email Share',
      LEARN_MORE    : 'Clicked Learn More',
      FAQ_BACK      : 'Clicked FAQ Back',
      COPY_LINK     : 'Clicked Copy Link',
      REMIND_FRIEND : 'Clicked Remind Friend'
    }
  };

  window.squatch.mode = {
    widgetMode     : '{{mode}}',
    POPUP_MODE     : 'POPUP',
    EMBED_MODE     : 'EMBED',
    DEMO_MODE      : 'DEMO',
    DEMO_EMBED_MODE: 'DEMO_EMBED',
    NOCONTENT_MODE : 'NOCONTENT'
  };

</script>
